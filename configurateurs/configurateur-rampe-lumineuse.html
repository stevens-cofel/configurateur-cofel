<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Configurateur Rampe lumineuse (PLL) - Cofel</title>

<!-- Styles communs Cofel -->
<link rel="stylesheet" href="../styles/cofel.css" />
<link rel="stylesheet" href="../styles/cofel-config.css" />

<!-- Retouches locales (uniquement visuel, pas de logique) -->
<style>
  /* Harmonisation des radios en “pills” comme sur les autres pages */
  .radio-row{display:flex;gap:8px;flex-wrap:wrap}
  .radio-row label{
    font-weight:600; border:1px solid #ddd; border-radius:10px;
    padding:6px 10px; display:flex; align-items:center; gap:8px; background:#fff;
  }
  /* Carte résultat un peu plus mise en avant */
  .result{
    background:#fcfaff; border:1px solid #dec5f2; border-radius:12px;
    padding:14px; margin:16px 0; text-align:center; font-size:18px;
    box-shadow:0 8px 18px rgba(90,45,130,.08);
  }
  .muted{color:#7d6f8e}
  .sub{font-size:14px;color:#4b3b5e;margin-top:6px}
  .hidden{display:none}
</style>
</head>
<body>

<!-- En-tête violet Cofel -->
<header class="cofel-header">
  <div class="row">
    <a class="cofel-back" href="../index.html">⬅ Retour aux configurateurs</a>
    <div class="cofel-brand">
      <img src="../assets/logo cofel.jpg" alt="Cofel" />
      <h1 class="cofel-title">Configurateur — Rampe lumineuse (PLL)</h1>
    </div>
  </div>
</header>

<!-- Conteneur commun (largeur, marges) -->
<div class="cofel-container">
  <h1 style="margin:8px 0 14px">Rampe lumineuse (PLL)</h1>

  <div class="wrap">
    <fieldset>
      <legend>Dimensions & quantité</legend>
      <div class="grid">
        <div>
          <label for="longueur">Longueur de rampe (mm)</label>
          <input type="number" id="longueur" min="1" placeholder="Ex : 2500" />
          <div class="muted">Tarif rampe (laquage inclus) : <b>100,00 € HT / m</b></div>
        </div>
        <div>
          <label for="quantite">Quantité</label>
          <input type="number" id="quantite" min="1" value="1" />
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Fixation (laquage inclus)</legend>
      <div class="radio-row">
        <label><input type="radio" name="fixation" value="directe" checked> Fixation directe — <b>5,00 € / u</b></label>
        <label><input type="radio" name="fixation" value="platine"> Platine avec déport — <b>15,00 € / u</b></label>
      </div>

      <div id="blocDeport" class="hidden" style="margin-top:8px">
        <label for="deport">Déport souhaité (mm)</label>
        <input type="number" id="deport" min="0" step="1" placeholder="Ex : 120" />
        <div class="muted">Le déport est informatif (pas d’impact tarifaire).</div>
      </div>
    </fieldset>

    <div class="result">
      <div>Prix unitaire HT : <span id="prixUHT">0,00</span> €</div>
      <div class="sub">
        Longueur : <span id="lenM">0,000</span> m •
        Fixations : <span id="nbFix">0</span> u (<span id="typeFix">directe</span>)
      </div>
      <div style="margin-top:10px">Total HT (×Qté) : <span id="prixHT">0,00</span> €</div>
      <div>Total TTC (TVA 20%) : <span id="prixTTC">0,00</span> €</div>
    </div>
  </div>
</div>

<!-- Pied de page Cofel -->
<footer class="cofel-footer">
  © Cofel — ZA du Perquoi, 72560 Changé — SIRET 927 659 458 00024 — TVA FR80927659458
</footer>

<script>
/*** CONFIG ***/
const TVA = 0.20;
const PRICE_RAMPE_ML = 100.00; // €/m linéaire (laquage inclus)
const PRICE_FIX_DIRECTE = 5.00; // €/u (laquage inclus)
const PRICE_FIX_PLATINE = 15.00; // €/u (laquage inclus)

/*** DOM ***/
const $ = id => document.getElementById(id);
const elL = $('longueur');
const elQ = $('quantite');
const elBlocDeport = $('blocDeport');
const elPrixUHT = $('prixUHT');
const elPrixHT = $('prixHT');
const elPrixTTC = $('prixTTC');
const elLenM = $('lenM');
const elNbFix = $('nbFix');
const elTypeFix = $('typeFix');

/*** UTILS ***/
function euro(n){ return (isFinite(n)?n:0).toFixed(2).replace('.', ','); }
function round3(n){ return Math.round(n*1000)/1000; }

/*** CALCUL ***/
function compute(){
  const Lmm = Math.max(0, Number(elL.value||0));
  const Lm = Lmm / 1000; // longueur en mètres
  const Q = Math.max(1, Number(elQ.value||1));

  // Type de fixation & tarif unitaire
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  const fixPrice = (fixVal === 'platine') ? PRICE_FIX_PLATINE : PRICE_FIX_DIRECTE;

  // Règle : 1 fixation par mètre linéaire, +1 (début/fin), minimum 2
  const nbFix = Math.max(2, Math.ceil(Lm) + 1);

  // Prix rampe (ml)
  const rampeHT = PRICE_RAMPE_ML * Lm;

  // Prix fixations
  const fixHT = fixPrice * nbFix;

  // Unitaire / Totaux
  const unitHT = rampeHT + fixHT;
  const totalHT = unitHT * Q;
  const totalTTC = totalHT * (1 + TVA);

  // UI
  elLenM.textContent = round3(Lm).toFixed(3).replace('.', ',');
  elNbFix.textContent = nbFix;
  elTypeFix.textContent = (fixVal === 'platine') ? 'platine' : 'directe';
  elPrixUHT.textContent = euro(unitHT);
  elPrixHT.textContent = euro(totalHT);
  elPrixTTC.textContent = euro(totalTTC);
}

/*** TOGGLES ***/
function toggleBlocks(){
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  elBlocDeport.classList.toggle('hidden', fixVal!=='platine');
}

/*** EVENTS ***/
['input','change'].forEach(evt=>{
  [longueur, quantite, deport, ...document.querySelectorAll('input[name="fixation"]')]
    .forEach(el => el.addEventListener(evt, ()=>{ toggleBlocks(); compute(); }));
});

/*** INIT ***/
toggleBlocks();
compute();
</script>
</body>
</html>
