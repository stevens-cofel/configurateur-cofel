<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <div style="background:#003366; padding:10px;">
  <a href="../index.html" style="
    color:white;
    text-decoration:none;
    font-weight:bold;
    font-family:Arial, sans-serif;
    background:#0055aa;
    padding:8px 14px;
    border-radius:6px;
    display:inline-block;
  ">
    ⬅ Retour aux configurateurs
  </a>
</div>

<title>Configurateur Rampe lumineuse (PLL) - Cofel</title>
<style>
  body{font-family:Arial, sans-serif;background:#f4f4f4;margin:0;padding:24px;color:#333}
  h1{text-align:center;margin:0 0 16px}
  .wrap{max-width:760px;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.08);padding:20px}
  label{display:block;margin-top:14px;font-weight:700}
  input,select,button{width:100%;padding:10px;margin-top:6px;border:1px solid #ccc;border-radius:8px;min-height:44px;font:inherit}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:820px){.grid{grid-template-columns:1fr}}
  fieldset{border:1px solid #ddd;border-radius:10px;padding:10px;margin-top:8px}
  fieldset legend{padding:0 8px;font-weight:700}
  .radio-row{display:flex;gap:8px;flex-wrap:wrap}
  .radio-row label{font-weight:normal;border:1px solid #ddd;border-radius:8px;padding:6px 10px;display:flex;align-items:center;gap:8px}
  .muted{color:#666;font-size:12px;margin-top:6px}
  .result{margin-top:18px;padding:14px;background:#e9f5ff;border:1px solid #b3e0ff;border-radius:10px;text-align:center;font-size:18px}
  .sub{font-size:14px;color:#444;margin-top:6px}
  .hidden{display:none}
</style>
</head>
<body>
<h1>Configurateur Rampe lumineuse (PLL)</h1>

<div class="wrap">
  <div class="grid">
    <div>
      <label for="longueur">Longueur de rampe (mm)</label>
      <input type="number" id="longueur" min="1" placeholder="Ex : 2500" />
      <div class="muted">Tarif rampe (laquage inclus) : <b>100,00 € HT / m</b></div>
    </div>
    <div>
      <label for="quantite">Quantité</label>
      <input type="number" id="quantite" min="1" value="1" />
    </div>
  </div>

  <fieldset>
    <legend>Fixation (laquage inclus)</legend>
    <div class="radio-row">
      <label><input type="radio" name="fixation" value="directe" checked> Fixation directe — <b>5,00 € / u</b></label>
      <label><input type="radio" name="fixation" value="platine"> Platine avec déport — <b>15,00 € / u</b></label>
    </div>

    <div id="blocDeport" class="hidden">
      <label for="deport">Déport souhaité (mm)</label>
      <input type="number" id="deport" min="0" step="1" placeholder="Ex : 120" />
      <div class="muted">Le déport est informatif (pas d’impact tarifaire).</div>
    </div>
  </fieldset>

  <div class="result">
    <div>Prix unitaire HT : <span id="prixUHT">0,00</span> €</div>
    <div class="sub">
      Longueur : <span id="lenM">0,000</span> m •
      Fixations : <span id="nbFix">0</span> u (<span id="typeFix">directe</span>)
    </div>
    <div style="margin-top:10px">Total HT (×Qté) : <span id="prixHT">0,00</span> €</div>
    <div>Total TTC (TVA 20%) : <span id="prixTTC">0,00</span> €</div>
  </div>
</div>

<script>
/*** CONFIG ***/
const TVA = 0.20;
const PRICE_RAMPE_ML = 100.00; // €/m linéaire (laquage inclus)
const PRICE_FIX_DIRECTE = 5.00; // €/u (laquage inclus)
const PRICE_FIX_PLATINE = 15.00; // €/u (laquage inclus)

/*** DOM ***/
const $ = id => document.getElementById(id);
const elL = $('longueur');
const elQ = $('quantite');
const elBlocDeport = $('blocDeport');
const elPrixUHT = $('prixUHT');
const elPrixHT = $('prixHT');
const elPrixTTC = $('prixTTC');
const elLenM = $('lenM');
const elNbFix = $('nbFix');
const elTypeFix = $('typeFix');

/*** UTILS ***/
function euro(n){ return (isFinite(n)?n:0).toFixed(2).replace('.', ','); }
function round3(n){ return Math.round(n*1000)/1000; }

/*** CALCUL ***/
function compute(){
  const Lmm = Math.max(0, Number(elL.value||0));
  const Lm = Lmm / 1000; // longueur en mètres
  const Q = Math.max(1, Number(elQ.value||1));

  // Type de fixation & tarif unitaire
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  const fixPrice = (fixVal === 'platine') ? PRICE_FIX_PLATINE : PRICE_FIX_DIRECTE;

  // Règle : 1 fixation par mètre linéaire, +1 (début/fin), minimum 2
  const nbFix = Math.max(2, Math.ceil(Lm) + 1);

  // Prix rampe (ml)
  const rampeHT = PRICE_RAMPE_ML * Lm;

  // Prix fixations
  const fixHT = fixPrice * nbFix;

  // Unitaire / Totaux
  const unitHT = rampeHT + fixHT;
  const totalHT = unitHT * Q;
  const totalTTC = totalHT * (1 + TVA);

  // UI
  elLenM.textContent = round3(Lm).toFixed(3).replace('.', ',');
  elNbFix.textContent = nbFix;
  elTypeFix.textContent = (fixVal === 'platine') ? 'platine' : 'directe';
  elPrixUHT.textContent = euro(unitHT);
  elPrixHT.textContent = euro(totalHT);
  elPrixTTC.textContent = euro(totalTTC);
}

/*** TOGGLES ***/
function toggleBlocks(){
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  elBlocDeport.classList.toggle('hidden', fixVal!=='platine');
}

/*** EVENTS ***/
['input','change'].forEach(evt=>{
  [longueur, quantite, deport, ...document.querySelectorAll('input[name="fixation"]')]
    .forEach(el => el.addEventListener(evt, ()=>{ toggleBlocks(); compute(); }));
});

/*** INIT ***/
toggleBlocks();
compute();
</script>
</body>
</html>

