<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Configurateur ‚Äî Rampe lumineuse (PLL) | Cofel</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<style>
  /* ====== DA Cofel : verre violet (harmonis√© sur le mod√®le "T√¥le Tablette") ====== */
  :root{
    --violet:#5a2d82;
    --violet-2:#7838a7;
    --glass: rgba(255,255,255,.08);
    --glass-hr: rgba(255,255,255,.14);
    --txt:#f5f7ff;
    --txt-dim:#e6e6ff;
    --accent:#c9b7ff;
    --radius:18px;
    --blur:18px;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--txt);
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Arial,sans-serif;
    background:
      radial-gradient(800px 500px at 20% -10%, rgba(255,255,255,.10), transparent 60%),
      radial-gradient(800px 500px at 110% 10%, rgba(255,255,255,.08), transparent 60%),
      linear-gradient(135deg, var(--violet), var(--violet-2));
  }

  /* ===== Header (style proche du mod√®le) ===== */
  .hero{position:relative;z-index:1;padding:40px 20px 24px;}
  .hero-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:16px;}
  .brand{
    display:flex;align-items:center;gap:14px;
    backdrop-filter:blur(var(--blur));
    background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06));
    border:1px solid rgba(255,255,255,.18);
    padding:10px 14px;border-radius:14px;box-shadow:var(--shadow);
  }
  .brand img{height:42px;border-radius:10px;object-fit:contain}
  .brand h1{font-size:clamp(18px,2.6vw,22px);margin:0}
  .tagline{max-width:1200px;margin:18px auto 0;padding:0 20px;color:var(--txt-dim)}

  /* ===== Panels / cartes verre ===== */
  .wrap{max-width:1200px;margin:26px auto;padding:0 20px 40px;}
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
    border:1px solid rgba(255,255,255,.2);
    border-radius:20px;padding:18px;box-shadow:var(--shadow);backdrop-filter:blur(var(--blur));
    margin-bottom:18px; position:relative; z-index:1;
  }
  .panel legend, .panel h2{margin:0 0 12px;font-size:clamp(18px,2.4vw,22px);letter-spacing:.2px;color:var(--accent)}

  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .muted{color:var(--txt-dim);font-size:12px;margin-top:6px}
  footer{color:#f3ecff;font-size:12px;text-align:center;padding:24px 10px;opacity:.9;}

  /* ===== Form controls (exact m√™me rendu que le mod√®le) ===== */
  label{font-weight:700;font-size:13px;color:var(--accent);}
  input[type="number"], input[type="text"], select{
    width:100%; margin-top:6px; padding:12px 12px; min-height:42px;
    background: rgba(255,255,255,.10); color:var(--txt);
    border:1px solid rgba(255,255,255,.24); border-radius:14px; outline:none;
    transition: border-color .18s ease, background .18s ease, box-shadow .18s ease;
    position:relative; z-index:1;
  }
  input::placeholder{color:#f0edff; opacity:.75}
  input:focus, select:focus{
    border-color: rgba(255,255,255,.38);
    background: rgba(255,255,255,.16);
    box-shadow: 0 0 0 4px rgba(255,255,255,.08) inset;
  }
  /* Menu d√©roulant harmonis√© (fond violet + lisible) */
  select{ appearance:auto; }
  select option{ background:#3c1f61; color:#fff; }
  select:focus{ z-index:1001; }

  /* ===== Radios / Pills ===== */
  .radio-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .radio-row label{
    display:flex;align-items:center;gap:8px;cursor:pointer;
    padding:10px 14px;border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
    border:1px solid rgba(255,255,255,.24); color:#fff; font-weight:700;
    box-shadow: var(--shadow);
  }
  .radio-row input[type="radio"], .radio-row input[type="checkbox"]{ width:18px;height:18px; accent-color:#cbb3ff; }

  /* ===== R√©sultat ===== */
  .result{
    background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
    border:1px solid rgba(255,255,255,.24);
    border-radius:16px; padding:16px; text-align:center; font-size:18px;
    box-shadow:0 8px 22px rgba(0,0,0,.28); color:#fff;
  }
  .result b{font-size:20px}
  .sub{font-size:14px;color:#fff;margin-top:6px}

  /* ===== Buttons ===== */
  .btn{
    appearance:none;border:none;cursor:pointer;font-weight:700;
    color:#0b0b0b;background:#fff;border-radius:12px;padding:10px 14px;
    box-shadow:0 10px 24px rgba(0,0,0,.25);
    transition:transform .16s, box-shadow .16s;
  }
  .btn:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(0,0,0,.28);}
  .btn-ghost{background:transparent;color:var(--txt);border:1px solid rgba(255,255,255,.24);}
</style>
</head>
<body>

<!-- ===================== HEADER ===================== -->
<div class="hero">
  <div class="hero-inner">
    <div class="brand">
      <img src="../assets/logo cofel.jpg" alt="Cofel" />
      <h1>Configurateur ‚Äî Rampe lumineuse (PLL)</h1>
    </div>
    <a class="brand" href="../index.html" style="text-decoration:none;color:inherit">‚¨Ö Retour accueil (devis)</a>
  </div>
  <div class="tagline">Calcule le prix d‚Äôune rampe lumineuse compl√®te avec laquage inclus.</div>
</div>

<!-- ===================== CONTENU ===================== -->
<main class="wrap">
  <section class="panel">
    <fieldset>
      <legend>üìè Dimensions & quantit√©</legend>
      <div class="grid">
        <div>
          <label for="longueur">Longueur de rampe (mm)</label>
          <input type="number" id="longueur" min="1" placeholder="Ex : 2500" />
          <div class="muted">Tarif rampe (laquage inclus) : <b>100,00 ‚Ç¨ HT / m</b></div>
        </div>
        <div>
          <label for="quantite">Quantit√©</label>
          <input type="number" id="quantite" min="1" value="1" />
        </div>
      </div>
    </fieldset>

    <fieldset style="margin-top:20px">
      <legend>üß± Fixation (laquage inclus)</legend>
      <div class="radio-row">
        <label><input type="radio" name="fixation" value="directe" checked> Fixation directe ‚Äî <b>5,00 ‚Ç¨ / u</b></label>
        <label><input type="radio" name="fixation" value="platine"> Platine avec d√©port ‚Äî <b>15,00 ‚Ç¨ / u</b></label>
      </div>

      <div id="blocDeport" class="hidden" style="margin-top:10px">
        <label for="deport">D√©port souhait√© (mm)</label>
        <input type="number" id="deport" min="0" step="1" placeholder="Ex : 120" />
        <div class="muted">Le d√©port est informatif (pas d‚Äôimpact tarifaire).</div>
      </div>
    </fieldset>

    <div class="result" style="margin-top:20px">
      <div>Prix unitaire HT : <b><span id="prixUHT">0,00</span> ‚Ç¨</b></div>
      <div class="sub">
        Longueur : <span id="lenM">0,000</span> m ‚Ä¢
        Fixations : <span id="nbFix">0</span> u (<span id="typeFix">directe</span>)
      </div>
      <div style="margin-top:10px">Total HT : <b><span id="prixHT">0,00</span> ‚Ç¨</b></div>
      <div>Total TTC (TVA 20%) : <b><span id="prixTTC">0,00</span> ‚Ç¨</b></div>
    </div>

    <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
      <button id="btnAddDevis" class="btn">‚ûï Ajouter au devis</button>
      <button id="btnReset" class="btn btn-ghost">üîÑ R√©initialiser</button>
    </div>
  </section>
</main>

<footer>
  ¬© Cofel ‚Äî ZA du Perquoi, 72560 Chang√© ‚Äî SIRET 927 659 458 00024 ‚Äî TVA FR80927659458
</footer>

<script>
/*** CONFIG ***/
const TVA = 0.20;
const PRICE_RAMPE_ML = 100.00;           // laquage inclus (m√©moire projet)
const PRICE_FIX_DIRECTE = 5.00;
const PRICE_FIX_PLATINE = 15.00;
const UPLIFT_PUBLIC = 2.0;

/*** DOM ***/
const $ = id => document.getElementById(id);
const elL = $('longueur');
const elQ = $('quantite');
const elBlocDeport = $('blocDeport');
const elPrixUHT = $('prixUHT');
const elPrixHT = $('prixHT');
const elPrixTTC = $('prixTTC');
const elLenM = $('lenM');
const elNbFix = $('nbFix');
const elTypeFix = $('typeFix');

function euro(n){return (isFinite(n)?n:0).toFixed(2).replace('.', ',');}
function round3(n){return Math.round(n*1000)/1000;}

function compute(){
  const Lmm = Math.max(0, Number(elL.value||0));
  const Lm = Lmm / 1000;
  const Q = Math.max(1, Number(elQ.value||1));
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  const fixPrice = (fixVal === 'platine') ? PRICE_FIX_PLATINE : PRICE_FIX_DIRECTE;
  const nbFix = Math.max(2, Math.ceil(Lm) + 1);
  const rampeHT = PRICE_RAMPE_ML * Lm;
  const fixHT = fixPrice * nbFix;
  const unitHT = (rampeHT + fixHT) * UPLIFT_PUBLIC; // affichage public
  const totalHT = unitHT * Q;
  const totalTTC = totalHT * (1 + TVA);

  elLenM.textContent = round3(Lm).toFixed(3).replace('.', ',');
  elNbFix.textContent = nbFix;
  elTypeFix.textContent = fixVal;
  elPrixUHT.textContent = euro(unitHT);
  elPrixHT.textContent = euro(totalHT);
  elPrixTTC.textContent = euro(totalTTC);
}

function toggleBlocks(){
  const fixVal = (document.querySelector('input[name="fixation"]:checked')||{}).value || 'directe';
  elBlocDeport.classList.toggle('hidden', fixVal!=='platine');
}

['input','change'].forEach(evt=>{
  [longueur, quantite, deport, ...document.querySelectorAll('input[name="fixation"]')]
    .forEach(el=>el.addEventListener(evt, ()=>{toggleBlocks();compute();}));
});

document.getElementById('btnReset').addEventListener('click',()=>{
  elL.value='';elQ.value=1;document.querySelector('input[value="directe"]').checked=true;
  $('deport').value='';toggleBlocks();compute();
});

toggleBlocks();
compute();
</script>

<!-- ===================== MOTEUR DE DEVIS ===================== -->
<script src="../js/devis-core.js"></script>
<script>
(function(){
  const btn = document.getElementById('btnAddDevis');
  if(!btn)return;
  function parseTotalHTPublic(){
    const txt=document.getElementById('prixHT').innerText.trim();
    return Number(txt.replace(/\s/g,'').replace(',','.'))||0;
  }
  btn.addEventListener('click',()=>{
    try{
      if(!window.Devis) throw new Error("Moteur de devis introuvable.");
      const Lmm=Math.max(0,Number(document.getElementById('longueur').value||0));
      const qte=Math.max(1,Number(document.getElementById('quantite').value||1));
      if(!(Lmm>0)){alert("Renseigne la longueur de rampe.");return;}
      const fixVal=(document.querySelector('input[name=\"fixation\"]:checked')||{}).value||'directe';
      const deport=Number(document.getElementById('deport')?.value||0);
      const total_ht_public=parseTotalHTPublic();
      if(total_ht_public<=0){alert("Le prix est √† 0, v√©rifie les param√®tres.");return;}
      const pu_public_ht=qte>0?total_ht_public/qte:0;
      const parts=[`Rampe lumineuse (PLL)`,`L ${Lmm} mm`,`Fixation: ${fixVal}`];
      if(fixVal==='platine'&&deport>0)parts.push(`D√©port ${deport} mm`);
      const designation=parts.join(' ‚Äî ');
      Devis.addLine({
        type:'Rampe lumineuse (PLL)',
        designation,
        quantite:qte,
        pu_public_ht:Number(pu_public_ht.toFixed(2))
      });
      alert(`‚úÖ Ligne ajout√©e au devis !\n${designation}\nQt√© : ${qte}\nPU HT : ${pu_public_ht.toFixed(2)} ‚Ç¨`);
    }catch(err){console.error(err);alert('Erreur : '+err.message);}    
  });
})();
</script>

</body>
</html>
