<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Configurateur Totems Cofel</title>
<title>Configurateur Totems â€“ Cofel</title>

<!-- Styles communs Cofel -->
<link rel="stylesheet" href="../styles/cofel.css" />
<link rel="stylesheet" href="../styles/cofel-config.css" />

<!-- Retouches locales (visuel uniquement) -->
<style>
  body{font-family:Arial, sans-serif;background:#f4f4f4;margin:0;padding:24px;color:#333}
  h1{text-align:center;margin:0 0 16px}
  .wrap{max-width:860px;margin:0 auto;background:#fff;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:24px}
  label{display:block;margin-top:14px;font-weight:700}
  select,input{width:100%;padding:10px;margin-top:6px;border:1px solid #d7d7d7;border-radius:6px}
  /* Harmonisation â€œpillsâ€ + cartes rÃ©sultat */
  .radio-row{display:flex;gap:8px;flex-wrap:wrap}
  .radio-row label,
  .opt-row{
    font-weight:600;border:1px solid #ddd;border-radius:10px;
    padding:6px 10px;display:flex;align-items:center;gap:8px;background:#fff;
  }
  .opt-row input[type="checkbox"]{transform:scale(1.1)}
  .wrap{max-width:860px;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.08);padding:20px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .result{margin-top:22px;padding:16px;background:#e9f5ff;border:1px solid #b3e0ff;border-radius:8px;font-size:18px;text-align:center}
  .muted{color:#777;font-size:12px;margin-top:8px;white-space:pre-wrap}
  .mapping{margin:16px 0;padding:12px;border:1px solid #ffd38a;background:#fff7e6;border-radius:8px}
  .result{
    background:#fcfaff;border:1px solid #dec5f2;border-radius:12px;
    padding:16px;margin:16px 0;text-align:center;font-size:18px;
    box-shadow:0 8px 18px rgba(90,45,130,.08);
  }
  .muted{color:#7d6f8e;font-size:12px;white-space:pre-wrap}
  .mapping{
    margin:16px 0;padding:12px;border:1px solid #ffd38a;background:#fff7e6;border-radius:12px
  }
  .mapping h3{margin:0 0 8px}
  .btn{display:inline-block;margin-top:8px;padding:8px 12px;border:1px solid #1976d2;background:#1976d2;color:#fff;border-radius:6px;cursor:pointer}
  .btn{
    display:inline-block;margin-top:8px;padding:10px 14px;border:1px solid #5a2d82;
    background:#5a2d82;color:#fff;border-radius:12px;cursor:pointer;font-weight:700;
    box-shadow:0 8px 18px rgba(90,45,130,.18)
  }
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .hr{height:1px;background:#eee;margin:16px 0}

  /* Options (cases Ã  cocher) */
  .options-wrap{margin-top:8px;border:1px solid #eee;border-radius:8px;padding:10px}
  .opt-row{display:flex;align-items:center;gap:8px;margin:6px 0}
  .opt-row input[type="checkbox"]{transform:scale(1.2)}
  .opt-row span.note{color:#999;font-size:12px}
  label{display:block;margin-top:10px;font-weight:700}
  select,input{width:100%;padding:10px;margin-top:6px;border:1px solid #ddd;border-radius:10px}
</style>
</head>
<body>
<h1>Configurateur Totems Cofel</h1>

<div class="wrap">
  <!-- MAPPAGE TARIFS -->
  <div id="mapTarifsBox" class="mapping" style="display:none">
    <h3>ğŸ“„ Mappage des colonnes TARIFS</h3>
    <div class="two">
      <div>
        <label>Colonne â€œType de faceâ€</label>
        <select id="mapT_Type"></select>
      </div>
      <div>
        <label>Colonne â€œPrix base HTâ€</label>
        <select id="mapT_Price"></select>
      </div>
      <div>
        <label>Colonne â€œHauteur (mm)â€</label>
        <select id="mapT_H"></select>
      </div>
      <div>
        <label>Colonne â€œLargeur (mm)â€</label>
        <select id="mapT_L"></select>
      </div>
<!-- Bandeau violet -->
<header class="cofel-header">
  <div class="row">
    <a class="cofel-back" href="../index.html">â¬… Retour aux configurateurs</a>
    <div class="cofel-brand">
      <img src="../assets/logo cofel.jpg" alt="Cofel" />
      <h1 class="cofel-title">Configurateur â€” Totems</h1>
    </div>
    <button id="applyMapTarifs" class="btn">Appliquer le mappage TARIFS</button>
  </div>

  <!-- MAPPAGE OPTIONS -->
  <div id="mapOptionsBox" class="mapping" style="display:none">
    <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
    <div class="two">
      <div>
        <label>Colonne â€œType dâ€™optionâ€ (Platine / Panier de crosses)</label>
        <select id="mapO_Type"></select>
</header>

<!-- Conteneur commun -->
<div class="cofel-container">
  <h1 style="margin:8px 0 14px">Totems</h1>

  <div class="wrap">
    <!-- MAPPAGE TARIFS -->
    <div id="mapTarifsBox" class="mapping" style="display:none">
      <h3>ğŸ“„ Mappage des colonnes TARIFS</h3>
      <div class="two">
        <div>
          <label>Colonne â€œType de faceâ€</label>
          <select id="mapT_Type"></select>
        </div>
        <div>
          <label>Colonne â€œPrix base HTâ€</label>
          <select id="mapT_Price"></select>
        </div>
        <div>
          <label>Colonne â€œHauteur (mm)â€</label>
          <select id="mapT_H"></select>
        </div>
        <div>
          <label>Colonne â€œLargeur (mm)â€</label>
          <select id="mapT_L"></select>
        </div>
      </div>
      <div>
        <label>Colonne â€œPrix unitaire HTâ€</label>
        <select id="mapO_Price"></select>
      </div>
      <div>
        <label>Colonne â€œHauteur min (mm)â€</label>
        <select id="mapO_HMin"></select>
      <button id="applyMapTarifs" class="btn">Appliquer le mappage TARIFS</button>
    </div>

    <!-- MAPPAGE OPTIONS -->
    <div id="mapOptionsBox" class="mapping" style="display:none">
      <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
      <div class="two">
        <div>
          <label>Colonne â€œType dâ€™optionâ€ (Platine / Panier de crosses)</label>
          <select id="mapO_Type"></select>
        </div>
        <div>
          <label>Colonne â€œPrix unitaire HTâ€</label>
          <select id="mapO_Price"></select>
        </div>
        <div>
          <label>Colonne â€œHauteur min (mm)â€</label>
          <select id="mapO_HMin"></select>
        </div>
        <div>
          <label>Colonne â€œHauteur max (mm)â€</label>
          <select id="mapO_HMax"></select>
        </div>
        <div>
          <label>Colonne â€œActifâ€ (Oui/True/1)</label>
          <select id="mapO_Actif"></select>
        </div>
      </div>
      <button id="applyMapOptions" class="btn">Appliquer le mappage OPTIONS</button>
    </div>

    <div class="hr"></div>

    <!-- UI CONFIG -->
    <label for="type">Type de face</label>
    <select id="type"><option value="">â€” sÃ©lectionnez â€”</option></select>

    <div class="grid">
      <div>
        <label>Colonne â€œHauteur max (mm)â€</label>
        <select id="mapO_HMax"></select>
        <label for="hauteur">Hauteur (mm)</label>
        <select id="hauteur"><option value="">â€” sÃ©lectionnez â€”</option></select>
      </div>
      <div>
        <label>Colonne â€œActifâ€ (Oui/True/1)</label>
        <select id="mapO_Actif"></select>
        <label for="largeur">Largeur (mm)</label>
        <select id="largeur"><option value="">â€” sÃ©lectionnez â€”</option></select>
      </div>
    </div>
    <button id="applyMapOptions" class="btn">Appliquer le mappage OPTIONS</button>
  </div>

  <div class="hr"></div>

  <!-- UI CONFIG -->
  <label for="type">Type de face</label>
  <select id="type"><option value="">â€” sÃ©lectionnez â€”</option></select>

  <div class="grid">
    <div>
      <label for="hauteur">Hauteur (mm)</label>
      <select id="hauteur"><option value="">â€” sÃ©lectionnez â€”</option></select>
    <label>Options (multi-choix)</label>
    <div id="optionsBox" class="options-wrap">
      <!-- cases Ã  cocher gÃ©nÃ©rÃ©es dynamiquement -->
      <div class="opt-row"><em>Aucune option disponible tant que la hauteur nâ€™est pas choisie.</em></div>
    </div>
    <div>
      <label for="largeur">Largeur (mm)</label>
      <select id="largeur"><option value="">â€” sÃ©lectionnez â€”</option></select>
    </div>
  </div>

  <label>Options (multi-choix)</label>
  <div id="optionsBox" class="options-wrap">
    <!-- cases Ã  cocher gÃ©nÃ©rÃ©es dynamiquement -->
    <div class="opt-row"><em>Aucune option disponible tant que la hauteur nâ€™est pas choisie.</em></div>
  </div>
    <label for="quantite">QuantitÃ©</label>
    <input type="number" id="quantite" value="1" min="1"/>

  <label for="quantite">QuantitÃ©</label>
  <input type="number" id="quantite" value="1" min="1"/>
    <div class="result">
      <p>Prix HT : <span id="prixHT">0,00</span> â‚¬</p>
      <p>Prix TTC : <span id="prixTTC">0,00</span> â‚¬</p>
    </div>

  <div class="result">
    <p>Prix HT : <span id="prixHT">0,00</span> â‚¬</p>
    <p>Prix TTC : <span id="prixTTC">0,00</span> â‚¬</p>
    <div id="msg" class="muted"></div>
  </div>

  <div id="msg" class="muted"></div>
</div>

<!-- Pied de page -->
<footer class="cofel-footer">
  Â© Cofel â€” ZA du Perquoi, 72560 ChangÃ© â€” SIRET 927 659 458 00024 â€” TVA FR80927659458
</footer>

<script>
/* ------- CONFIG ------- */
const URL_TARIFS  = "https://raw.githubusercontent.com/stevens-cofel/configurateur-cofel/refs/heads/main/Tarifs_Totems_.csv";
@@ -147,7 +183,6 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
const elMsg  = document.getElementById('msg');

/* ------- HELPERS ------- */
// Extrait un nombre mÃªme si la cellule contient "1 500 mm", "1,500", etc.
function num(v){
  const s = String(v ?? '').replace(/\u202F/g,'').replace(/\s/g,'').replace(',', '.');
  const m = s.match(/-?\d+(\.\d+)?/);
@@ -238,15 +273,14 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
}

function renderOptionsCheckboxes(){
  // familles dâ€™options (ex.: Platine, Panier de crossesâ€¦)
  const families = [...new Set(OPTIONS.map(o=>o.typeOption))].filter(Boolean).sort();
  if(!families.length){
    elOptsBox.innerHTML = '<div class="opt-row"><em>Aucune option disponible.</em></div>';
    return;
  }
  const h = num(elH.value);
  const isValid = (fam)=>{
    if(!h) return false; // rien tant que hauteur non choisie
    if(!h) return false;
    const rows = OPTIONS.filter(o =>
      o.typeOption===fam &&
      !isNaN(o.hmin) && !isNaN(o.hmax) &&
@@ -258,7 +292,7 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>

  elOptsBox.innerHTML = families.map(f=>{
    const ok = isValid(f);
    const note = ok ? '' : ` <span class="note">(non dispo pour H=${elH.value||'â€”'})</span>`;
    const note = ok ? '' : ` <span class="muted">(non dispo pour H=${elH.value||'â€”'})</span>`;
    return `
      <label class="opt-row">
        <input type="checkbox" name="opt" value="${f}" ${ok?'':'disabled'}>
@@ -267,17 +301,15 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
    `;
  }).join('');

  // Ã©couteurs sur les cases
  [...elOptsBox.querySelectorAll('input[name="opt"]')].forEach(cb=>{
    cb.addEventListener('change', compute);
  });

  // petit message dâ€™aide
  if(!h){
    elMsg.textContent = "Choisis dâ€™abord la hauteur pour activer les options.";
  }else{
    const valides = families.filter(f=>!elOptsBox.querySelector(`input[value="${f}"]`)?.disabled);
    elMsg.textContent = `Hauteur sÃ©lectionnÃ©e: ${elH.value} | Options valides: ${valides.join(', ') || 'aucune'}`;
    const valides = families.filter(f=>!elOptsBox.querySelector(\`input[value="\${f}"]\`)?.disabled);
    elMsg.textContent = \`Hauteur sÃ©lectionnÃ©e: \${elH.value} | Options valides: \${valides.join(', ') || 'aucune'}\`;
  }
}

@@ -296,7 +328,6 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
  return row ? row.priceBase : 0;
}
function priceOptionsSum(){
  // somme des prix des options cochÃ©es
  const checked = [...elOptsBox.querySelectorAll('input[name="opt"]:checked')].map(c=>c.value);
  if(!checked.length) return 0;
  const h = num(elH.value);
@@ -329,16 +360,15 @@ <h3>ğŸ§© Mappage des colonnes OPTIONS</h3>
    RAW_TARIFFS = pT.rows; RAW_HEADERS_T = pT.rawHeads; HEADS_T = pT.heads;
    RAW_OPTIONS = pO.rows; RAW_HEADERS_O = pO.rawHeads; HEADS_O = pO.heads;

    // suggestions
    suggestMapTarifs(); suggestMapOptions();

    // UI mapping
    const mapTarifsBox  = document.getElementById('mapTarifsBox');
    const mapOptionsBox = document.getElementById('mapOptionsBox');

    const setSel = (id, heads, raws, val)=>{
      const el = document.getElementById(id);
      fillSelect(el, heads, raws);
      el.innerHTML = '<option value="">â€” choisir â€”</option>' +
        heads.map((k,i)=>`<option value="${k}">${raws[i]}</option>`).join('');
      if(val) el.value = val;
      return el;
    };
